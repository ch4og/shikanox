#!/usr/bin/env bash
# SPDX-FileCopyrightText: 2025 Nikita Mitasov <me@ch4og.com>
# SPDX-License-Identifier: GPL-3.0-or-later

set -euo pipefail

input="guix/shika/lib/channels.template"
output="guix/shika/lib/channels.scm"

replacement=$(guix time-machine --channels="$input" -- describe --format=channels)

awk -v rep="$replacement"\) '
/;;; %shika-chs start/ {print rep; skip=1; next}
skip && /;;; %shika-chs end/ {skip=0; next}
!skip {print}
' "$input" > "$output"

emacs --batch $output --eval '(progn (indent-region (point-min) (point-max)) (save-buffer))'
